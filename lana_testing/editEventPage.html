<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Event Forum</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <!-- Header Section -->
    <header>
        <div class="logo">YOUR LOGO</div>
        <nav>
            <a href="eventListPage.html">Event List</a>
            <a href="#">Member List</a>
            <a href="#">Links</a>
        </nav>
    </header>

    <!-- Main Section -->
    <main>

        <!-- This is layout for user input-->
        <h1>Edit Event</h1>
        <form id="editEventForum" action="editEventUpdateEventsScript.php" method="POST">
            <input type="hidden" id="eventId" name="eventId">

            <label for="name">Event Name:</label>
            <input type="text" id="name" name="name" required><br><br>

            <label for="date">Select a date:</label>
            <input type="date" id="date" name="date" required><br><br>

            <label for="time">Select a time:</label>
            <input type="time" id="time" name="time" required><br><br>

            <label for="location">Location:</label>
            <input type="text" id="location" name="location" required><br><br>

            <label for="info">Info/Details:</label>
            <input type="text" id="info" name="info"><br><br>

            <button type="submit">Update Event</button>
        </form>

        <!-- Popup Message-->
        <div id="popup" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border: 1px solid #ccc; z-index: 1000;">
            <span id="popupMessage"></span>
            <br><br>
            <button onclick="closePopup()">Close</button>
        </div>
        
        <!-- Overlay -->
        <div id="overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 999;"></div>
        

        <!-- Javascript -->
            <!-- Main Functions in Script -->
            <!-- 1. Loads details from event (Similar to createEvent) -->
            <!-- 2. Load details into page upon load -->
            <!-- 3. Popup Confirmation (Similar to createEvent)-->
        <script>
            // 1. Function prefill the form
            function loadEventDetails() {
                // Get event ID from the query parameter in the URL (When edit button is clicked, it sends the event ID in the URL)
                // This is to maintain not embedding the php code in the html to help with separation
                const params = new URLSearchParams(window.location.search);
                const eventId = params.get('eventId');

                // If event ID provided, get data
                if (eventId) {
                    // Get event data
                    // I wrote some notes about .json in editEventScript.php if you want to understand more on whats going on
                    fetch(`editEventScript.php?eventId=${eventId}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                document.getElementById('eventId').value = data.event.id;
                                document.getElementById('name').value = data.event.name;
                                document.getElementById('date').value = data.event.date;
                                document.getElementById('time').value = data.event.time;
                                document.getElementById('location').value = data.event.location;
                                document.getElementById('info').value = data.event.info;
                            } else {
                                alert(data.message);
                            }
                        })
                        .catch(error => console.error('Error:', error));
                } else {
                    alert("No event ID provided.");
                }
            }

            // 2. Load details when the page loads
            window.onload = loadEventDetails;

            // 3. Popup Confirmation
            // Form submission
            document.getElementById("editEventForum").addEventListener("submit", function (event) {
                event.preventDefault(); // No default form action
        
                const formData = new FormData(this); // Form data
        
                // AJAX (Asynchronous JavaScript and XML) request
                // Uses fetch which waits for script
                // Then displays the response of script in the popup
                fetch("editEventUpdateEventsScript.php", {
                    method: "POST",
                    body: formData,
                })
                    .then((response) => response.text()) // Expecting a plain text response
                    .then((data) => {
                        // Response
                        document.getElementById("popupMessage").innerHTML = data;
                        document.getElementById("popup").style.display = "block";
                        document.getElementById("overlay").style.display = "block";
                    })
                    // In case of errors
                    .catch((error) => {
                        document.getElementById("popupMessage").innerHTML = "Error: " + error.message;
                        document.getElementById("popup").style.display = "block";
                        document.getElementById("overlay").style.display = "block";
                    });
            });
        
            // Close popup
            function closePopup() {
                document.getElementById("popup").style.display = "none";
                document.getElementById("overlay").style.display = "none";
            }
                
        </script>

    </main>

    <!-- Footer Section -->
    <footer>
        Footer
    </footer>

</body>
</html>
